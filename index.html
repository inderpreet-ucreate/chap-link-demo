
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>Timeline demo</title>
    
        <style type="text/css">
            body {font: 10pt arial;}
        </style>
    
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript" src="./timeline.js"></script>
        <link rel="stylesheet" type="text/css" href="./timeline.css">
    
        <script type="text/javascript">
            var currentTime = new Date();
            var currentYear = currentTime.getFullYear();
            var tenYearPast = (currentYear-10).toString();
            var endRange = (currentYear+5).toString();
            var defaultEra = new Date(1900, 0, 1);
            var timeline;
            var fullRange = [tenYearPast,
                defaultEra,
                new Date(1400, 0, 1),
                '0000',
                new Date(-3000, 0, 1),
                new Date(-200000, 0, 1),
                new Date(-271820, 0, 1)
                // new Date(-3000000000, 0, 1),
                // new Date(-4550000000, 0, 1),
                // new Date(-13800000000, 0, 1)
                ];
            var currentIndex = 1;
            var startRange;
            var data;
            
            var ddData = "[{\"title\":\"Tree\",\"date\":{\"isCreatedByOther\":false,\"flagComment\":\"\",\"score\":0,\"createdAt\":\"2020-09-02T16:57:57.695+0530\",\"endDate\":\"\",\"updatedAt\":\"2020-09-02T16:58:11.237+0530\",\"UserName\":\"\",\"flagByUserName\":\"\",\"endDate_BC\":\"\",\"startDateType\":0,\"startDate\":\"\",\"flagByUserId\":\"\",\"isBan\":false,\"endDateType\":0,\"startDate_BC\":\"\",\"isBC\":false,\"UserID\":\"\",\"derivedFromId\":\"\",\"flag\":\"\"},\"id\":\"gf02DrSaZsQwx8YeCNYH\",\"filter\":{\"sortBy_Timeline\":0},\"createdAt\":\"02-09-2020\",\"updatedAt\":\"02-09-2020\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"userName\":\"Bikram Saini\"},{\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"02-09-2020\",\"updatedAt\":\"02-09-2020\",\"filter\":{\"sortBy_Timeline\":0},\"title\":\"Brave New World\",\"date\":{\"flagComment\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"UserName\":\"Bikram Saini\",\"endDateType\":0,\"startDate_BC\":\"\",\"isBan\":false,\"derivedFromId\":\"RVjUPKXTXEVo0ZyBpirm\",\"flagByUserId\":\"\",\"updatedAt\":\"2020-09-02T16:58:29.631+0530\",\"createdAt\":\"2020-09-02T15:15:27.568+0530\",\"startDate\":\"1932\",\"startDateType\":1,\"endDate_BC\":\"\",\"isBC\":false,\"flag\":\"\",\"score\":0,\"endDate\":\"\",\"flagByUserName\":\"\",\"isCreatedByOther\":false},\"id\":\"rh3nHSuwvwije3rcVrdB\",\"userName\":\"Bikram Saini\"},{\"filter\":{\"sortBy_Timeline\":0},\"createdAt\":\"02-09-2020\",\"date\":{\"createdAt\":\"2020-09-02T14:52:14.466+0530\",\"flagComment\":\"\",\"endDate_BC\":\"\",\"score\":0,\"isBan\":false,\"updatedAt\":\"2020-09-02T16:58:15.513+0530\",\"isCreatedByOther\":false,\"isBC\":false,\"startDate\":\"\",\"flagByUserName\":\"\",\"derivedFromId\":\"\",\"UserID\":\"\",\"UserName\":\"\",\"flag\":\"\",\"endDateType\":0,\"flagByUserId\":\"\",\"endDate\":\"\",\"startDateType\":0,\"startDate_BC\":\"\"},\"updatedAt\":\"02-09-2020\",\"id\":\"1K10Gej5FC1xTlB7Y3Nd\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"title\":\"COVID-19 apps\",\"userName\":\"Bikram Saini\"},{\"title\":\"First Notary of the Kingdom\",\"id\":\"poilQbt1qHNNeRobXKJm\",\"updatedAt\":\"02-09-2020\",\"userName\":\"Bikram Saini\",\"filter\":{\"sortBy_Timeline\":0},\"date\":{\"isCreatedByOther\":false,\"startDate\":\"2020\",\"isBan\":false,\"createdAt\":\"2020-08-03T11:30:02.448+0530\",\"score\":0,\"endDate_BC\":\"\",\"endDateType\":1,\"flagByUserId\":\"\",\"UserName\":\"Bikram Saini\",\"startDateType\":1,\"startDate_BC\":\"\",\"endDate\":\"2020\",\"flagComment\":\"\",\"flagByUserName\":\"\",\"flag\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"updatedAt\":\"2020-09-02T16:56:10.665+0530\",\"derivedFromId\":\"IB3NU5UJv462rxFCpVLS\",\"isBC\":false},\"createdAt\":\"03-08-2020\",\"userId\":\"IB3NU5UJv462rxFCpVLS\"},{\"userName\":\"Bikram Saini\",\"filter\":{\"sortBy_Timeline\":0},\"updatedAt\":\"02-09-2020\",\"id\":\"jrskrBK5iALWUFTMG73C\",\"title\":\"Cartoon Network\",\"cover\":{\"name\":\"1596115827166\",\"url\":\"https:\\/\\/firebasestorage.googleapis.com\\/v0\\/b\\/polybook-staging.appspot.com\\/o\\/version%2F1%2Fnote%2FjrskrBK5iALWUFTMG73C%2Fcover%2F1596115827166?alt=media&token=e8235cec-370f-4ee1-ba67-a89b148e6868\"},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"30-07-2020\",\"date\":{\"createdAt\":\"2020-07-30T18:49:19.498+0530\",\"endDate_BC\":\"\",\"flagComment\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"startDate_BC\":\"\",\"score\":0,\"flagByUserName\":\"\",\"isBC\":false,\"flagByUserId\":\"\",\"flag\":\"\",\"updatedAt\":\"2020-09-02T16:56:13.076+0530\",\"isBan\":false,\"UserName\":\"Bikram Saini\",\"endDateType\":2,\"startDate\":\"02-2020\",\"derivedFromId\":\"\",\"isCreatedByOther\":false,\"startDateType\":2,\"endDate\":\"01-2021\"}},{\"date\":{\"derivedFromId\":\"\",\"flagByUserId\":\"\",\"UserName\":\"Bikram Saini\",\"score\":0,\"isCreatedByOther\":false,\"endDateType\":3,\"startDateType\":3,\"createdAt\":\"2020-07-30T18:48:06.828+0530\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"endDate\":\"01-10-2020\",\"endDate_BC\":\"\",\"flagComment\":\"\",\"isBan\":false,\"flagByUserName\":\"\",\"flag\":\"\",\"startDate_BC\":\"\",\"isBC\":false,\"updatedAt\":\"2020-09-02T16:56:16.439+0530\",\"startDate\":\"31-08-2020\"},\"createdAt\":\"30-07-2020\",\"id\":\"mNwOYC1vl7eLqSgIqDPl\",\"userName\":\"Bikram Saini\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"updatedAt\":\"02-09-2020\",\"title\":\"WWE Championship\",\"filter\":{\"sortBy_Timeline\":0}},{\"date\":{\"endDate_BC\":\"15450\",\"flagComment\":\"\",\"score\":0,\"flagByUserId\":\"\",\"isBan\":false,\"startDate\":\"\",\"startDate_BC\":\"15300\",\"startDateType\":0,\"derivedFromId\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"updatedAt\":\"2020-09-02T16:55:14.526+0530\",\"endDateType\":0,\"flagByUserName\":\"\",\"createdAt\":\"2020-07-30T18:47:07.484+0530\",\"isCreatedByOther\":false,\"UserName\":\"Bikram Saini\",\"isBC\":true,\"flag\":\"\",\"endDate\":\"\"},\"filter\":{\"sortBy_Timeline\":0},\"title\":\"WWE 24\\/7 Championship\",\"id\":\"gTeb30iIJNNbf0cZAtb3\",\"userName\":\"Bikram Saini\",\"updatedAt\":\"02-09-2020\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"30-07-2020\"},{\"filter\":{\"sortBy_Timeline\":0},\"userName\":\"Bikram Saini\",\"id\":\"JPm6yaqFLE94EWluyZd0\",\"createdAt\":\"29-07-2020\",\"title\":\"Person\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"updatedAt\":\"30-07-2020\",\"date\":{\"startDate_BC\":\"\",\"flagByUserName\":\"\",\"createdAt\":\"2020-07-29T19:29:48.823+0530\",\"derivedFromId\":\"\",\"UserName\":\"\",\"endDate\":\"\",\"isBC\":false,\"UserID\":\"\",\"flagComment\":\"\",\"updatedAt\":\"2020-07-30T13:36:38.159+0530\",\"endDateType\":0,\"score\":0,\"startDate\":\"\",\"isBan\":false,\"flagByUserId\":\"\",\"startDateType\":0,\"endDate_BC\":\"\",\"flag\":\"\",\"isCreatedByOther\":false}},{\"userName\":\"Bikram Saini\",\"title\":\"History\",\"updatedAt\":\"02-09-2020\",\"filter\":{\"sortBy_Timeline\":0},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"date\":{\"startDateType\":0,\"isBan\":false,\"derivedFromId\":\"\",\"score\":0,\"endDateType\":0,\"updatedAt\":\"2020-09-02T16:56:20.478+0530\",\"isCreatedByOther\":false,\"endDate_BC\":\"\",\"flagComment\":\"\",\"startDate_BC\":\"\",\"startDate\":\"\",\"UserID\":\"\",\"endDate\":\"\",\"isBC\":false,\"flagByUserName\":\"\",\"flag\":\"\",\"createdAt\":\"2020-07-29T19:29:26.795+0530\",\"flagByUserId\":\"\",\"UserName\":\"\"},\"createdAt\":\"29-07-2020\",\"id\":\"PDeU8SBcwxADrfXgY5Up\"},{\"date\":{\"endDate\":\"\",\"startDate_BC\":\"\",\"endDateType\":0,\"score\":0,\"derivedFromId\":\"\",\"isBan\":false,\"endDate_BC\":\"\",\"createdAt\":\"2020-07-29T19:28:59.125+0530\",\"UserName\":\"\",\"UserID\":\"\",\"flagByUserName\":\"\",\"startDateType\":0,\"flagByUserId\":\"\",\"isBC\":false,\"flag\":\"\",\"flagComment\":\"\",\"isCreatedByOther\":false,\"startDate\":\"\",\"updatedAt\":\"2020-09-02T16:55:29.426+0530\"},\"title\":\"History Person\",\"id\":\"DJ472VGewLVt3Ofa3wwx\",\"filter\":{\"sortBy_Timeline\":0},\"updatedAt\":\"02-09-2020\",\"userName\":\"Bikram Saini\",\"createdAt\":\"29-07-2020\",\"userId\":\"IB3NU5UJv462rxFCpVLS\"},{\"title\":\"Taj Mahal\",\"id\":\"XVs2zxtFOPfSJGs6pkbz\",\"userName\":\"Bikram Saini\",\"createdAt\":\"29-07-2020\",\"updatedAt\":\"02-09-2020\",\"filter\":{\"sortBy_Timeline\":0},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"date\":{\"createdAt\":\"2020-07-29T16:33:37.785+0530\",\"flagByUserName\":\"\",\"UserName\":\"Bikram Saini\",\"endDate_BC\":\"\",\"startDate\":\"29-07-2020\",\"updatedAt\":\"2020-09-02T16:56:23.599+0530\",\"flagByUserId\":\"\",\"flag\":\"\",\"derivedFromId\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"startDateType\":3,\"endDateType\":3,\"isBan\":false,\"startDate_BC\":\"\",\"endDate\":\"29-07-2020\",\"isBC\":false,\"flagComment\":\"\",\"score\":0,\"isCreatedByOther\":false}},{\"createdAt\":\"29-07-2020\",\"id\":\"ACptLovjk1FJfIhUheE5\",\"filter\":{\"sortBy_Timeline\":0},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"userName\":\"Bikram Saini\",\"updatedAt\":\"29-07-2020\",\"date\":{\"endDate_BC\":\"\",\"isBan\":false,\"startDate\":\"\",\"UserName\":\"\",\"isBC\":false,\"updatedAt\":\"2020-07-29T15:05:39.182+0530\",\"score\":0,\"createdAt\":\"2020-07-29T12:58:51.170+0530\",\"flag\":\"\",\"UserID\":\"\",\"flagComment\":\"\",\"isCreatedByOther\":false,\"flagByUserId\":\"\",\"derivedFromId\":\"\",\"startDateType\":0,\"endDate\":\"\",\"endDateType\":0,\"startDate_BC\":\"\",\"flagByUserName\":\"\"},\"title\":\"Test\"}]"

            function injectData(injectedData = null) {
                prepareData(injectedData);
            }

            function prepareData(inputData) {
                data = [];
                var parsedData = JSON.parse(inputData);                
                if (parsedData.length) {
                    parsedData.forEach(element => {
                        var dateObject = '';
                        if (element.filter.sortBy_Timeline) {
                            if (element.date.startDate || element.date.startDate_BC) {
                                var startDate = element.date.startDate || element.date.startDate_BC;
                                var startDateParts = startDate.split('-');
                                switch(startDateParts.length) {
                                    case 3:
                                        dateObject = new Date(startDateParts[2], startDateParts[1]-1, startDateParts[0]);
                                        break;
                                    case 2:
                                        dateObject = new Date(startDateParts[1], startDateParts[0]-1);
                                        break;
                                    default:
                                        if (element.date.isBC) {
                                            var yearOnly = -(startDateParts[0] - 1);
                                        } else {
                                            var yearOnly = startDateParts[0];
                                        }
                                        dateObject = new Date(yearOnly, 0);
                                }
                            }                            
                        } else {
                            var startDateParts = element.createdAt.split('-');
                            dateObject = new Date(startDateParts[2], startDateParts[1]-1, startDateParts[0]);
                        }
                        if (dateObject != '') {
                            data.push({
                                'start': dateObject,
                                'content': `<a href="javascript:(0)" data class="note-content" onclick="passNoteToApp('${element.title}')"><div style="background-color: white;padding: 6px;border-radius: 6px;color:black; box-shadow: 0 0 11px #ccc; z-index: 9999999;">${element.title}</div></a>`
                            });                                
                        }
                    });
                    if (data.length) {
                        google.setOnLoadCallback(drawVisualization);
                    }
                }
            }
            
            google.load("visualization", "1");
    
            // Set callback to run when API is loaded
            google.setOnLoadCallback(drawVisualization);
            
            // Called when the Visualization API is loaded.
            function drawVisualization() {
                // specify options
                var options = {
                    width:  "100%",
                    height: "85%",
                    style: "dot",
                    min: new Date(-271820, 0, 1),
                    autoResize: true
                };
    
                // Instantiate our timeline object.
                timeline = new links.Timeline(document.getElementById('mytimeline'), options);
                // Draw our timeline with the created data and options
                if (typeof data == 'undefined' || !data.length) {
                    data = {
                        'start': '',
                        'content': ''
                    }
                }
                timeline.draw(data);
                startRange = defaultEra;
                timeline.setVisibleChartRange(startRange, endRange);
            }
            function passNoteToApp(noteTitle) {
                window.webkit.messageHandlers.notesDataHandler.postMessage({title: noteTitle})
            }
            window.onload = function(){
                injectData(ddData);
                document.getElementById("filter").onclick = function(){
                    window.webkit.messageHandlers.filterHandler.postMessage({filterClicked: true})
                }
                document.getElementById("out").onclick = function(){
                    if (currentIndex <= 5) {
                        var newIndex = currentIndex + 1;
                        timeline.setVisibleChartRange(fullRange[newIndex], endRange);
                        currentIndex = newIndex;
                    }                    
                }
                document.getElementById("in").onclick = function(){
                    if (currentIndex) {
                        var newIndex = currentIndex - 1;
                        timeline.setVisibleChartRange(fullRange[newIndex], endRange);
                        currentIndex = newIndex;
                    }
                }
            };
        </script>
    </head>
    
    <body>
        <div>
            <div id="mytimeline" style="background-color: #F9F5EB"></div>
            <div id="bottomDiv" style="display: flex; border: 1px solid #BEBEBE; border-top: none; min-height: 50px; align-items: center;">
                <div class="out-box bottom-col">
                    <a href="javascript:void(0)" id="out">
                        <img src="img/ZOOM_ICON_OUT_2.png" class="icons">
                    </a>
                </div>
                <div class="filter-box bottom-col">
                    <a href="javascript:void(0)" id="filter">
                        <img src="img/FILTER_ICON.png" class="icons">
                    </a>
                </div>
                <div class="in-box bottom-col">
                    <a href="javascript:void(0)" id="in">
                        <img src="img/ZOOM_ICON_IN_2.png" class="icons">
                    </a>
                </div>
            </div>
        </div>
    
    
    </body>
    </html>
    