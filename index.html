
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>Timeline demo</title>
    
        <style type="text/css">
            body {font: 10pt arial;}
        </style>
    
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript" src="./timeline.js"></script>
        <link rel="stylesheet" type="text/css" href="./timeline.css">
    
        <script type="text/javascript">
            var currentTime = new Date();
            var firstDayOfMonth = new Date(currentTime.getFullYear(), currentTime.getMonth(), 1).toLocaleString().split(',')[0];
            var firstDayOfMonthSplitted = firstDayOfMonth.split('/');
            var lastDayOfMonth = new Date(currentTime.getFullYear(), currentTime.getMonth() + 1, 0).toLocaleString().split(',')[0];
            var lastDayOfMonthSplitted = lastDayOfMonth.split('/');
            var currentYear = currentTime.getFullYear();
            var tenYearPast = (currentYear-10).toString();
            var endRange = (currentYear+5).toString();
            var defaultEra = new Date(1900, 0, 1);
            var timeline;
            var fullRange = [
                {start: new Date(firstDayOfMonthSplitted[2], firstDayOfMonthSplitted[1]-1, firstDayOfMonthSplitted[0]),
                    end: new Date(lastDayOfMonthSplitted[2], lastDayOfMonthSplitted[1]-1, lastDayOfMonthSplitted[0]),},
                {start: new Date(currentYear, 0, 1), end: new Date(currentYear, 11, 31)},
                {start: new Date(tenYearPast, 0, 1), end: new Date(currentYear, 11, 31)},
                {start: defaultEra, end: new Date(currentYear, 11, 31)},
                {start: new Date(1400, 0, 1), end: new Date(currentYear, 11, 31)},
                {start: '0000', end: new Date(currentYear, 11, 31)},
                {start: new Date(-3000, 0, 1), end: new Date(currentYear, 11, 31)},
                {start: new Date(-200000, 0, 1), end: new Date(currentYear, 11, 31)},
                {start: new Date(-264000, 0, 1), end: new Date(currentYear, 11, 31)}
                // new Date(-3000000000, 0, 1),
                // new Date(-4550000000, 0, 1),
                // new Date(-13800000000, 0, 1)
                ];
            var currentIndex = 3;
            var startRange;
            var data;
            
            var ddData = "[{\"title\":\"Brave New World\",\"userName\":\"Bikram Saini\",\"id\":\"rh3nHSuwvwije3rcVrdB\",\"updatedAt\":\"2020-09-02T15:15:27.568+0530\",\"filter\":{\"sortBy_Timeline\":1},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"date\":{\"flagByUserName\":\"\",\"startDate\":\"\",\"isBC\":false,\"UserName\":\"\",\"isCreatedByOther\":false,\"UserID\":\"\",\"endDateType\":0,\"createdAt\":\"2020-09-02T15:15:27.568+0530\",\"endDate_BC\":\"\",\"isBan\":false,\"startDate_BC\":\"\",\"score\":0,\"derivedFromId\":\"\",\"updatedAt\":\"2020-09-02T15:15:27.568+0530\",\"flag\":\"\",\"startDateType\":0,\"endDate\":\"\",\"flagByUserId\":\"\",\"flagComment\":\"\"},\"createdAt\":\"2020-09-02T15:15:27.567+0530\"},{\"filter\":{\"sortBy_Timeline\":1},\"userName\":\"Bikram Saini\",\"createdAt\":\"2020-09-02T14:52:14.466+0530\",\"title\":\"COVID-19 apps\",\"date\":{\"endDate\":\"\",\"flagByUserName\":\"\",\"endDate_BC\":\"\",\"flag\":\"\",\"createdAt\":\"2020-09-02T14:52:14.466+0530\",\"updatedAt\":\"2020-09-02T14:52:14.467+0530\",\"startDate\":\"\",\"isBan\":false,\"startDate_BC\":\"\",\"startDateType\":0,\"isBC\":false,\"UserName\":\"\",\"derivedFromId\":\"\",\"endDateType\":0,\"UserID\":\"\",\"flagComment\":\"\",\"isCreatedByOther\":false,\"flagByUserId\":\"\",\"score\":0},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"id\":\"1K10Gej5FC1xTlB7Y3Nd\",\"updatedAt\":\"2020-09-02T14:52:14.467+0530\"},{\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"filter\":{\"sortBy_Timeline\":1},\"date\":{\"startDate_BC\":\"\",\"endDate\":\"2020\",\"endDate_BC\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"UserName\":\"Bikram Saini\",\"flagByUserName\":\"\",\"updatedAt\":\"2020-09-02T13:42:54.787+0530\",\"flagByUserId\":\"\",\"createdAt\":\"2020-08-03T11:30:02.448+0530\",\"isBC\":false,\"score\":0,\"derivedFromId\":\"IB3NU5UJv462rxFCpVLS\",\"flag\":\"\",\"endDateType\":1,\"startDate\":\"2020\",\"flagComment\":\"\",\"isBan\":false,\"startDateType\":1,\"isCreatedByOther\":false},\"id\":\"poilQbt1qHNNeRobXKJm\",\"title\":\"First Notary of the Kingdom\",\"createdAt\":\"2020-08-03T11:30:02.448+0530\",\"updatedAt\":\"2020-09-02T13:42:54.787+0530\",\"userName\":\"Bikram Saini\"},{\"createdAt\":\"2020-07-30T18:49:19.498+0530\",\"cover\":{\"url\":\"https:\\/\\/firebasestorage.googleapis.com\\/v0\\/b\\/polybook-staging.appspot.com\\/o\\/version%2F1%2Fnote%2FjrskrBK5iALWUFTMG73C%2Fcover%2F1596115827166?alt=media&token=e8235cec-370f-4ee1-ba67-a89b148e6868\",\"name\":\"1596115827166\"},\"updatedAt\":\"2020-09-02T13:45:54.578+0530\",\"title\":\"Cartoon Network\",\"date\":{\"score\":0,\"UserName\":\"Bikram Saini\",\"startDateType\":2,\"isBC\":false,\"endDateType\":2,\"flagByUserId\":\"\",\"updatedAt\":\"2020-09-02T13:45:54.579+0530\",\"flagByUserName\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"endDate\":\"01-2021\",\"endDate_BC\":\"\",\"flagComment\":\"\",\"isBan\":false,\"startDate\":\"02-2020\",\"createdAt\":\"2020-07-30T18:49:19.498+0530\",\"startDate_BC\":\"\",\"flag\":\"\",\"isCreatedByOther\":false,\"derivedFromId\":\"\"},\"id\":\"jrskrBK5iALWUFTMG73C\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"filter\":{\"sortBy_Timeline\":1},\"userName\":\"Bikram Saini\"},{\"date\":{\"updatedAt\":\"2020-08-31T13:37:44.411+0530\",\"score\":0,\"flag\":\"\",\"isCreatedByOther\":false,\"flagByUserName\":\"\",\"endDate\":\"01-10-2020\",\"endDateType\":3,\"derivedFromId\":\"\",\"startDate_BC\":\"\",\"startDate\":\"31-08-2020\",\"startDateType\":3,\"isBan\":false,\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"flagComment\":\"\",\"flagByUserId\":\"\",\"endDate_BC\":\"\",\"createdAt\":\"2020-07-30T18:48:06.828+0530\",\"UserName\":\"Bikram Saini\",\"isBC\":false},\"filter\":{\"sortBy_Timeline\":1},\"id\":\"mNwOYC1vl7eLqSgIqDPl\",\"updatedAt\":\"2020-08-31T13:37:44.411+0530\",\"title\":\"WWE Championship\",\"userName\":\"Bikram Saini\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"2020-07-30T18:48:06.828+0530\"},{\"filter\":{\"sortBy_Timeline\":1},\"title\":\"WWE 24\\/7 Championship\",\"userName\":\"Bikram Saini\",\"id\":\"gTeb30iIJNNbf0cZAtb3\",\"createdAt\":\"2020-07-30T18:47:07.484+0530\",\"updatedAt\":\"2020-08-31T13:38:08.598+0530\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"date\":{\"startDate_BC\":\"15300\",\"endDate_BC\":\"15450\",\"isBan\":false,\"isBC\":true,\"startDate\":\"\",\"score\":0,\"createdAt\":\"2020-07-30T18:47:07.484+0530\",\"UserName\":\"Bikram Saini\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"flagComment\":\"\",\"flag\":\"\",\"isCreatedByOther\":false,\"flagByUserName\":\"\",\"startDateType\":0,\"updatedAt\":\"2020-08-31T13:38:08.598+0530\",\"endDateType\":0,\"derivedFromId\":\"\",\"flagByUserId\":\"\",\"endDate\":\"\"}},{\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"filter\":{\"sortBy_Timeline\":1},\"userName\":\"Bikram Saini\",\"createdAt\":\"2020-07-29T19:29:48.823+0530\",\"date\":{\"isCreatedByOther\":false,\"updatedAt\":\"2020-07-30T13:36:38.159+0530\",\"UserName\":\"\",\"startDateType\":0,\"createdAt\":\"2020-07-29T19:29:48.823+0530\",\"startDate\":\"\",\"startDate_BC\":\"\",\"flag\":\"\",\"flagByUserId\":\"\",\"flagByUserName\":\"\",\"endDateType\":0,\"endDate_BC\":\"\",\"endDate\":\"\",\"score\":0,\"flagComment\":\"\",\"isBan\":false,\"UserID\":\"\",\"isBC\":false,\"derivedFromId\":\"\"},\"id\":\"JPm6yaqFLE94EWluyZd0\",\"title\":\"Person\",\"updatedAt\":\"2020-07-30T13:36:38.159+0530\"},{\"userName\":\"Bikram Saini\",\"id\":\"PDeU8SBcwxADrfXgY5Up\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"filter\":{\"sortBy_Timeline\":1},\"title\":\"History\",\"updatedAt\":\"2020-07-29T19:29:44.178+0530\",\"createdAt\":\"2020-07-29T19:29:26.795+0530\",\"date\":{\"flagByUserName\":\"\",\"createdAt\":\"2020-07-29T19:29:26.795+0530\",\"updatedAt\":\"2020-07-29T19:29:44.178+0530\",\"derivedFromId\":\"\",\"flag\":\"\",\"score\":0,\"startDate_BC\":\"\",\"UserName\":\"\",\"endDate_BC\":\"\",\"flagByUserId\":\"\",\"UserID\":\"\",\"isBan\":false,\"startDateType\":0,\"flagComment\":\"\",\"endDate\":\"\",\"isCreatedByOther\":false,\"isBC\":false,\"startDate\":\"\",\"endDateType\":0}},{\"filter\":{\"sortBy_Timeline\":1},\"createdAt\":\"2020-07-29T19:28:59.125+0530\",\"date\":{\"isCreatedByOther\":false,\"isBan\":false,\"startDate\":\"\",\"UserID\":\"\",\"endDateType\":0,\"score\":0,\"startDate_BC\":\"\",\"flag\":\"\",\"isBC\":false,\"endDate_BC\":\"\",\"derivedFromId\":\"\",\"UserName\":\"\",\"updatedAt\":\"2020-07-29T19:29:18.749+0530\",\"startDateType\":0,\"flagComment\":\"\",\"endDate\":\"\",\"flagByUserId\":\"\",\"createdAt\":\"2020-07-29T19:28:59.125+0530\",\"flagByUserName\":\"\"},\"userName\":\"Bikram Saini\",\"title\":\"History Person\",\"id\":\"DJ472VGewLVt3Ofa3wwx\",\"updatedAt\":\"2020-07-29T19:29:18.749+0530\",\"userId\":\"IB3NU5UJv462rxFCpVLS\"},{\"title\":\"Taj Mahal\",\"userName\":\"Bikram Saini\",\"createdAt\":\"2020-07-29T16:33:37.785+0530\",\"id\":\"XVs2zxtFOPfSJGs6pkbz\",\"date\":{\"flagByUserName\":\"\",\"startDate_BC\":\"\",\"startDateType\":3,\"endDate_BC\":\"\",\"startDate\":\"29-07-2020\",\"endDate\":\"29-07-2020\",\"derivedFromId\":\"\",\"createdAt\":\"2020-07-29T16:33:37.785+0530\",\"flagComment\":\"\",\"isCreatedByOther\":false,\"UserName\":\"Bikram Saini\",\"endDateType\":3,\"isBC\":false,\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"isBan\":false,\"updatedAt\":\"2020-07-29T16:34:23.376+0530\",\"score\":0,\"flagByUserId\":\"\",\"flag\":\"\"},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"updatedAt\":\"2020-07-29T16:34:23.376+0530\",\"filter\":{\"sortBy_Timeline\":1}},{\"createdAt\":\"2020-07-29T12:58:51.168+0530\",\"title\":\"Test\",\"updatedAt\":\"2020-07-29T15:05:39.182+0530\",\"id\":\"ACptLovjk1FJfIhUheE5\",\"filter\":{\"sortBy_Timeline\":1},\"date\":{\"endDateType\":0,\"flagByUserName\":\"\",\"isBan\":false,\"flagByUserId\":\"\",\"endDate_BC\":\"\",\"UserID\":\"\",\"updatedAt\":\"2020-07-29T15:05:39.182+0530\",\"createdAt\":\"2020-07-29T12:58:51.170+0530\",\"isBC\":false,\"startDate\":\"\",\"isCreatedByOther\":false,\"derivedFromId\":\"\",\"flag\":\"\",\"score\":0,\"UserName\":\"\",\"endDate\":\"\",\"flagComment\":\"\",\"startDateType\":0,\"startDate_BC\":\"\"},\"userName\":\"Bikram Saini\",\"userId\":\"IB3NU5UJv462rxFCpVLS\"}]"

            function injectData(injectedData = null) {
                prepareData(injectedData);
            }

            function prepareData(inputData) {
                data = [];
                var parsedData = JSON.parse(inputData);                
                if (parsedData.length) {
                    parsedData.forEach(element => {
                        var dateObject = '';
                        if (element.filter.sortBy_Timeline) {
                            console.log('if');
                            if (element.date.startDate || element.date.startDate_BC) {
                                var startDate = element.date.startDate || element.date.startDate_BC;
                                var startDateParts = startDate.split('-');
                                switch(startDateParts.length) {
                                    case 3:
                                        dateObject = new Date(startDateParts[2], startDateParts[1]-1, startDateParts[0]);
                                        break;
                                    case 2:
                                        dateObject = new Date(startDateParts[1], startDateParts[0]-1);
                                        break;
                                    default:
                                        if (element.date.isBC) {
                                            var yearOnly = -(startDateParts[0] - 1);
                                        } else {
                                            var yearOnly = startDateParts[0];
                                        }
                                        dateObject = new Date(yearOnly, 0);
                                }
                            }                            
                        } else {
                            console.log('else');
                            var startDateParts = element.createdAt.split('-');
                            dateObject = new Date(startDateParts[2], startDateParts[1]-1, startDateParts[0]);
                        }
                        if (dateObject != '') {
                            data.push({
                                'start': dateObject,
                                'content': `<a href="javascript:(0)" data class="note-content" onclick="passNoteToApp('${element.title}')"><div style="background-color: white;padding: 6px;border-radius: 6px;color:black; box-shadow: 0 0 11px #ccc; z-index: 9999999;">${element.title}</div></a>`
                            });                                
                        }
                    });
                    if (data.length) {
                        google.setOnLoadCallback(drawVisualization);
                    }
                }
            }
            
            google.load("visualization", "1");
    
            // Set callback to run when API is loaded
            google.setOnLoadCallback(drawVisualization);
            
            // Called when the Visualization API is loaded.
            function drawVisualization() {
                // specify options
                var options = {
                    width:  "100%",
                    height: "85%",
                    style: "dot",
                    min: new Date(-265500, 0, 1),
                    autoResize: true
                };
    
                // Instantiate our timeline object.
                timeline = new links.Timeline(document.getElementById('mytimeline'), options);
                // Draw our timeline with the created data and options
                if (typeof data == 'undefined' || !data.length) {
                    data = {
                        'start': '',
                        'content': ''
                    }
                }
                timeline.draw(data);
                startRange = defaultEra;
                timeline.setVisibleChartRange(startRange, endRange);
            }
            function passNoteToApp(noteTitle) {
                window.webkit.messageHandlers.notesDataHandler.postMessage({title: noteTitle})
            }
            window.onload = function(){
                injectData(ddData);
                document.getElementById("filter").onclick = function(){
                    window.webkit.messageHandlers.filterHandler.postMessage({filterClicked: true})
                }
                document.getElementById("out").onclick = function(){
                    if (currentIndex <= 7) {
                        var newIndex = currentIndex + 1;
                        timeline.setVisibleChartRange(fullRange[newIndex].start, fullRange[newIndex].end);
                        currentIndex = newIndex;
                    }                    
                }
                document.getElementById("in").onclick = function(){
                    if (currentIndex) {
                        var newIndex = currentIndex - 1;
                        timeline.setVisibleChartRange(fullRange[newIndex].start, fullRange[newIndex].end);
                        currentIndex = newIndex;
                    }
                }
            };
        </script>
    </head>
    
    <body>
        <div>
            <div id="mytimeline" style="background-color: #F9F5EB"></div>
            <div id="bottomDiv" style="display: flex; border: 1px solid #BEBEBE; border-top: none; min-height: 50px; align-items: center;">
                <div class="out-box bottom-col">
                    <a href="javascript:void(0)" id="out">
                        <img src="img/ZOOM_ICON_OUT_2.png" class="icons">
                    </a>
                </div>
                <div class="filter-box bottom-col">
                    <a href="javascript:void(0)" id="filter">
                        <img src="img/FILTER_ICON.png" class="icons">
                    </a>
                </div>
                <div class="in-box bottom-col">
                    <a href="javascript:void(0)" id="in">
                        <img src="img/ZOOM_ICON_IN_2.png" class="icons">
                    </a>
                </div>
            </div>
        </div>
    
    
    </body>
    </html>
    