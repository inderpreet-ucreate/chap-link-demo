
<html>
    <head>
        <title>Timeline demo</title>
    
        <style type="text/css">
            body {font: 10pt arial;}
        </style>
    
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript" src="./timeline.js"></script>
        <link rel="stylesheet" type="text/css" href="./timeline.css">
    
        <script type="text/javascript">
            var currentTime = new Date();
            var currentYear = currentTime.getFullYear();
            var tenYearPast = (currentYear-10).toString();
            var endRange = (currentYear+5).toString();
            var defaultEra = new Date(1900, 0, 1);
            var timeline;
            var fullRange = [tenYearPast,
                defaultEra,
                new Date(1400, 0, 1),
                '0000',
                new Date(-3000, 0, 1),
                new Date(-200000, 0, 1),
                new Date(-271820, 0, 1)
                // new Date(-3000000000, 0, 1),
                // new Date(-4550000000, 0, 1),
                // new Date(-13800000000, 0, 1)
                ];
            var currentIndex = 1;
            var startRange;
            var data;
            
            var ddData = "[{\"date\":{\"createdAt\":\"2020-09-02T15:15:27.568+0530\",\"UserID\":\"\",\"derivedFromId\":\"\",\"updatedAt\":\"2020-09-02T15:15:27.568+0530\",\"flag\":\"\",\"startDate\":\"\",\"isCreatedByOther\":false,\"endDate\":\"\",\"isBan\":false,\"endDateType\":0,\"flagByUserId\":\"\",\"startDate_BC\":\"\",\"UserName\":\"\",\"endDate_BC\":\"\",\"startDateType\":0,\"flagByUserName\":\"\",\"isBC\":false,\"flagComment\":\"\",\"score\":0},\"title\":\"Brave New World\",\"userName\":\"Bikram Saini\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"filter\":{\"sortBy_Timeline\":0},\"updatedAt\":\"2020-09-02T15:15:27.568+0530\",\"id\":\"rh3nHSuwvwije3rcVrdB\",\"createdAt\":\"2020-09-02T15:15:27.567+0530\"},{\"id\":\"1K10Gej5FC1xTlB7Y3Nd\",\"title\":\"COVID-19 apps\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"date\":{\"flagByUserId\":\"\",\"flag\":\"\",\"endDate\":\"\",\"createdAt\":\"2020-09-02T14:52:14.466+0530\",\"UserID\":\"\",\"isBan\":false,\"UserName\":\"\",\"isCreatedByOther\":false,\"score\":0,\"derivedFromId\":\"\",\"flagComment\":\"\",\"startDateType\":0,\"endDate_BC\":\"\",\"startDate\":\"\",\"endDateType\":0,\"startDate_BC\":\"\",\"updatedAt\":\"2020-09-02T14:52:14.467+0530\",\"isBC\":false,\"flagByUserName\":\"\"},\"createdAt\":\"2020-09-02T14:52:14.466+0530\",\"filter\":{\"sortBy_Timeline\":0},\"userName\":\"Bikram Saini\",\"updatedAt\":\"2020-09-02T14:52:14.467+0530\"},{\"id\":\"poilQbt1qHNNeRobXKJm\",\"filter\":{\"sortBy_Timeline\":0},\"createdAt\":\"2020-08-03T11:30:02.448+0530\",\"userName\":\"Bikram Saini\",\"updatedAt\":\"2020-09-02T13:42:54.787+0530\",\"date\":{\"createdAt\":\"2020-08-03T11:30:02.448+0530\",\"startDate\":\"2020\",\"UserName\":\"Bikram Saini\",\"updatedAt\":\"2020-09-02T13:42:54.787+0530\",\"derivedFromId\":\"IB3NU5UJv462rxFCpVLS\",\"isBan\":false,\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"flagByUserName\":\"\",\"flagComment\":\"\",\"endDateType\":1,\"startDate_BC\":\"\",\"flagByUserId\":\"\",\"score\":0,\"isCreatedByOther\":false,\"endDate_BC\":\"\",\"isBC\":false,\"startDateType\":1,\"flag\":\"\",\"endDate\":\"2020\"},\"title\":\"First Notary of the Kingdom\",\"userId\":\"IB3NU5UJv462rxFCpVLS\"},{\"userName\":\"Bikram Saini\",\"filter\":{\"sortBy_Timeline\":0},\"title\":\"Cartoon Network\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"2020-07-30T18:49:19.498+0530\",\"updatedAt\":\"2020-09-02T13:45:54.578+0530\",\"date\":{\"startDate\":\"02-2020\",\"endDate_BC\":\"\",\"UserName\":\"Bikram Saini\",\"updatedAt\":\"2020-09-02T13:45:54.579+0530\",\"flagByUserId\":\"\",\"startDateType\":2,\"isCreatedByOther\":false,\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"2020-07-30T18:49:19.498+0530\",\"isBan\":false,\"flag\":\"\",\"endDate\":\"01-2021\",\"startDate_BC\":\"\",\"score\":0,\"flagComment\":\"\",\"flagByUserName\":\"\",\"endDateType\":2,\"derivedFromId\":\"\",\"isBC\":false},\"id\":\"jrskrBK5iALWUFTMG73C\",\"cover\":{\"url\":\"https:\\/\\/firebasestorage.googleapis.com\\/v0\\/b\\/polybook-staging.appspot.com\\/o\\/version%2F1%2Fnote%2FjrskrBK5iALWUFTMG73C%2Fcover%2F1596115827166?alt=media&token=e8235cec-370f-4ee1-ba67-a89b148e6868\",\"name\":\"1596115827166\"}},{\"createdAt\":\"2020-07-30T18:48:06.828+0530\",\"id\":\"mNwOYC1vl7eLqSgIqDPl\",\"title\":\"WWE Championship\",\"filter\":{\"sortBy_Timeline\":0},\"date\":{\"createdAt\":\"2020-07-30T18:48:06.828+0530\",\"isBan\":false,\"startDate_BC\":\"\",\"flagComment\":\"\",\"score\":0,\"flagByUserName\":\"\",\"flagByUserId\":\"\",\"derivedFromId\":\"\",\"startDate\":\"31-08-2020\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"startDateType\":3,\"endDate_BC\":\"\",\"updatedAt\":\"2020-08-31T13:37:44.411+0530\",\"flag\":\"\",\"endDate\":\"01-10-2020\",\"UserName\":\"Bikram Saini\",\"endDateType\":3,\"isCreatedByOther\":false,\"isBC\":false},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"userName\":\"Bikram Saini\",\"updatedAt\":\"2020-08-31T13:37:44.411+0530\"},{\"createdAt\":\"2020-07-30T18:47:07.484+0530\",\"filter\":{\"sortBy_Timeline\":0},\"title\":\"WWE 24\\/7 Championship\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"date\":{\"flagComment\":\"\",\"startDate_BC\":\"15300\",\"createdAt\":\"2020-07-30T18:47:07.484+0530\",\"isCreatedByOther\":false,\"updatedAt\":\"2020-08-31T13:38:08.598+0530\",\"score\":0,\"startDate\":\"\",\"endDate\":\"\",\"isBC\":true,\"UserName\":\"Bikram Saini\",\"isBan\":false,\"startDateType\":0,\"flag\":\"\",\"flagByUserId\":\"\",\"flagByUserName\":\"\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"endDate_BC\":\"15450\",\"derivedFromId\":\"\",\"endDateType\":0},\"userName\":\"Bikram Saini\",\"id\":\"gTeb30iIJNNbf0cZAtb3\",\"updatedAt\":\"2020-08-31T13:38:08.598+0530\"},{\"date\":{\"endDate_BC\":\"\",\"flagComment\":\"\",\"isCreatedByOther\":false,\"updatedAt\":\"2020-07-30T13:36:38.159+0530\",\"flagByUserId\":\"\",\"derivedFromId\":\"\",\"flagByUserName\":\"\",\"flag\":\"\",\"createdAt\":\"2020-07-29T19:29:48.823+0530\",\"UserID\":\"\",\"score\":0,\"endDate\":\"\",\"endDateType\":0,\"isBC\":false,\"UserName\":\"\",\"startDate\":\"\",\"startDateType\":0,\"isBan\":false,\"startDate_BC\":\"\"},\"updatedAt\":\"2020-07-30T13:36:38.159+0530\",\"id\":\"JPm6yaqFLE94EWluyZd0\",\"filter\":{\"sortBy_Timeline\":0},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"title\":\"Person\",\"createdAt\":\"2020-07-29T19:29:48.823+0530\",\"userName\":\"Bikram Saini\"},{\"date\":{\"isBC\":false,\"flagByUserId\":\"\",\"flagComment\":\"\",\"endDateType\":0,\"createdAt\":\"2020-07-29T19:29:26.795+0530\",\"endDate_BC\":\"\",\"updatedAt\":\"2020-07-29T19:29:44.178+0530\",\"endDate\":\"\",\"startDateType\":0,\"UserName\":\"\",\"startDate_BC\":\"\",\"startDate\":\"\",\"isBan\":false,\"score\":0,\"flagByUserName\":\"\",\"flag\":\"\",\"isCreatedByOther\":false,\"UserID\":\"\",\"derivedFromId\":\"\"},\"id\":\"PDeU8SBcwxADrfXgY5Up\",\"createdAt\":\"2020-07-29T19:29:26.795+0530\",\"filter\":{\"sortBy_Timeline\":0},\"userName\":\"Bikram Saini\",\"title\":\"History\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"updatedAt\":\"2020-07-29T19:29:44.178+0530\"},{\"userName\":\"Bikram Saini\",\"title\":\"History Person\",\"date\":{\"isCreatedByOther\":false,\"UserName\":\"\",\"updatedAt\":\"2020-07-29T19:29:18.749+0530\",\"flagByUserName\":\"\",\"endDateType\":0,\"flagByUserId\":\"\",\"startDateType\":0,\"endDate_BC\":\"\",\"isBan\":false,\"flagComment\":\"\",\"startDate\":\"\",\"derivedFromId\":\"\",\"flag\":\"\",\"startDate_BC\":\"\",\"UserID\":\"\",\"isBC\":false,\"endDate\":\"\",\"createdAt\":\"2020-07-29T19:28:59.125+0530\",\"score\":0},\"updatedAt\":\"2020-07-29T19:29:18.749+0530\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"id\":\"DJ472VGewLVt3Ofa3wwx\",\"filter\":{\"sortBy_Timeline\":0},\"createdAt\":\"2020-07-29T19:28:59.125+0530\"},{\"filter\":{\"sortBy_Timeline\":0},\"date\":{\"flagComment\":\"\",\"startDate\":\"29-07-2020\",\"isBC\":false,\"UserName\":\"Bikram Saini\",\"UserID\":\"IB3NU5UJv462rxFCpVLS\",\"isCreatedByOther\":false,\"endDateType\":3,\"createdAt\":\"2020-07-29T16:33:37.785+0530\",\"endDate_BC\":\"\",\"isBan\":false,\"startDate_BC\":\"\",\"flag\":\"\",\"updatedAt\":\"2020-07-29T16:34:23.376+0530\",\"derivedFromId\":\"\",\"score\":0,\"startDateType\":3,\"endDate\":\"29-07-2020\",\"flagByUserId\":\"\",\"flagByUserName\":\"\"},\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"2020-07-29T16:33:37.785+0530\",\"updatedAt\":\"2020-07-29T16:34:23.376+0530\",\"title\":\"Taj Mahal\",\"id\":\"XVs2zxtFOPfSJGs6pkbz\",\"userName\":\"Bikram Saini\"},{\"title\":\"Test\",\"date\":{\"endDate_BC\":\"\",\"score\":0,\"startDate_BC\":\"\",\"createdAt\":\"2020-07-29T12:58:51.170+0530\",\"flagByUserName\":\"\",\"startDateType\":0,\"UserName\":\"\",\"flagComment\":\"\",\"flag\":\"\",\"derivedFromId\":\"\",\"endDate\":\"\",\"flagByUserId\":\"\",\"updatedAt\":\"2020-07-29T15:05:39.182+0530\",\"UserID\":\"\",\"isBan\":false,\"startDate\":\"\",\"isCreatedByOther\":false,\"isBC\":false,\"endDateType\":0},\"userName\":\"Bikram Saini\",\"id\":\"ACptLovjk1FJfIhUheE5\",\"filter\":{\"sortBy_Timeline\":0},\"updatedAt\":\"2020-07-29T15:05:39.182+0530\",\"userId\":\"IB3NU5UJv462rxFCpVLS\",\"createdAt\":\"2020-07-29T12:58:51.168+0530\"}]"

            function injectData(injectedData = null) {
                prepareData(injectedData);
            }

            function prepareData(inputData) {
                data = [];
                var parsedData = JSON.parse(inputData);                
                if (parsedData.length) {
                    parsedData.forEach(element => {
                        var dateObject = '';
                        if (element.filter.sortBy_Timeline) {
                            console.log('if');
                            if (element.date.startDate || element.date.startDate_BC) {
                                var startDate = element.date.startDate || element.date.startDate_BC;
                                var startDateParts = startDate.split('-');                            
                                switch(startDateParts.length) {
                                    case 3:
                                        dateObject = new Date(startDateParts[2], startDateParts[1]-1, startDateParts[0]);
                                        break;
                                    case 2:
                                        dateObject = new Date(startDateParts[1], startDateParts[0]-1);
                                        break;
                                    default:
                                        if (element.date.isBC) {
                                            var yearOnly = -(startDateParts[0] - 1);
                                        } else {
                                            var yearOnly = startDateParts[0];
                                        }
                                        dateObject = new Date(yearOnly, 0);
                                }
                            }                            
                        } else {
                            console.log('else');
                            var createdDate = new Date(element.createdAt);
                            dateObject = new Date(createdDate.getFullYear(), ('0' + createdDate.getMonth()).slice(-2), ('0' + createdDate.getDate()).slice(-2))
                            console.log(dateObject);
                        }
                        if (dateObject != '') {
                            data.push({
                                'start': dateObject,
                                'content': `<a href="javascript:(0)" data class="note-content" onclick="passNoteToApp('${element.title}')"><div style="background-color: white;padding: 6px;border-radius: 6px;color:black; box-shadow: 0 0 11px #ccc; z-index: 9999999;">${element.title}</div></a>`
                            });                                
                        }
                    });
                    if (data.length) {
                        google.setOnLoadCallback(drawVisualization);
                    }
                }
            }
            
            google.load("visualization", "1");
    
            // Set callback to run when API is loaded
            google.setOnLoadCallback(drawVisualization);
            
            // Called when the Visualization API is loaded.
            function drawVisualization() {
                // specify options
                var options = {
                    width:  "100%",
                    height: "90%",
                    style: "dot",
                    min: new Date(-271820, 0, 1),
                    autoResize: true
                };
    
                // Instantiate our timeline object.
                timeline = new links.Timeline(document.getElementById('mytimeline'), options);
                // Draw our timeline with the created data and options
                if (typeof data == 'undefined' || !data.length) {
                    data = {
                        'start': '',
                        'content': ''
                    }
                }
                timeline.draw(data);
                startRange = defaultEra;
                timeline.setVisibleChartRange(startRange, endRange);
            }
            function passNoteToApp(noteTitle) {
                window.webkit.messageHandlers.notesDataHandler.postMessage({title: noteTitle})
            }
            window.onload = function(){
                injectData(ddData);
                document.getElementById("filter").onclick = function(){
                    window.webkit.messageHandlers.filterHandler.postMessage({filterClicked: true})
                }
                document.getElementById("out").onclick = function(){
                    if (currentIndex <= 5) {
                        var newIndex = currentIndex + 1;
                        timeline.setVisibleChartRange(fullRange[newIndex], endRange);
                        currentIndex = newIndex;
                    }                    
                }
                document.getElementById("in").onclick = function(){
                    if (currentIndex) {
                        var newIndex = currentIndex - 1;
                        timeline.setVisibleChartRange(fullRange[newIndex], endRange);
                        currentIndex = newIndex;
                    }
                }
            };
        </script>
    </head>
    
    <body>
        <div>
            <div id="mytimeline" style="background-color: #F9F5EB"></div>
            <div id="bottomDiv" style="display: flex; border: 1px solid #BEBEBE; border-top: none; min-height: 50px; align-items: center;">
                <div class="out-box bottom-col">
                    <a href="javascript:void(0)" id="out">
                        <img src="img/ZOOM_ICON_OUT_2.png" class="icons">
                    </a>
                </div>
                <div class="filter-box bottom-col">
                    <a href="javascript:void(0)" id="filter">
                        <img src="img/FILTER_ICON.png" class="icons">
                    </a>
                </div>
                <div class="in-box bottom-col">
                    <a href="javascript:void(0)" id="in">
                        <img src="img/ZOOM_ICON_IN_2.png" class="icons">
                    </a>
                </div>
            </div>
        </div>
    
    
    </body>
    </html>
    